<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="user/fragments :: head"/>
<body>

<div class="wrapper">
    <nav th:replace="user/fragments :: topBar"></nav>
    <header th:replace="user/fragments :: navigation"></header>
    <!--    ==============================================BODY==============================================-->
    <section id="cart-page">
        <div class="container" >
            <!-- ========================================= CONTENT ========================================= -->
            <div class="col-xs-12 col-md-9 items-holder no-margin" id="listProductInCart" >

                <th:block th:each="item : ${listProductInCart}">
                    <div class="row no-margin cart-item">
                        <div class="col-xs-12 col-sm-2 no-margin">
                            <a href="#" class="thumb-holder">
                                <img class="lazy" th:alt="${item.getSanpham().getAnh()}"
                                     th:src="${'/image/' + item.getSanpham().getMaSp()+ '/' + item.getSanpham().getAnh()}"/>
                            </a>
                        </div>

                        <div class="col-xs-12 col-sm-5 ">
                            <div class="title">
                                <a href="#" th:text="${item.getSanpham().getTenSp()}"></a>
                            </div>
                            <div class="brand">sony</div>
                        </div>
                        <div class="col-xs-12 col-sm-2 no-margin">
                            <div class="quantity">
                                <div class="le-quantity">
                                    <a class="minus" id="reduceProduct"
                                       th:onclick="'changeNumberProduct('+${item.getSanpham().getMaSp()}+','+${maDH}+',-1);'"
                                       href="#reduce"></a>
                                    <input name="quantity" readonly="readonly" type="text"
                                           th:value="${item.getSoluong()}"/>
                                    <a class="plus" id="addProduct"
                                       th:onclick="'changeNumberProduct('+${item.getSanpham().getMaSp()}+','+${maDH}+',1);'"
                                       href="#add"></a>
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-12 col-sm-3 no-margin">
                            <div class="price"
                                 th:text="${#numbers.formatDecimal(item.getTonggia(), 0, 'COMMA', 0, 'POINT') +' VNĐ'}">
                            </div>
                            <a class="close-btn"
                               onclick="return confirm('Bạn có chắc muốn xoá sản phẩm này ??')"
                               th:href="${'/cart/delete?maSP=' + item.getSanpham().maSp }"></a>
                        </div>
                    </div><!-- /.cart-item -->
                </th:block>

            </div>
            <!-- ========================================= CONTENT : END ========================================= -->

            <!-- ========================================= SIDEBAR ========================================= -->

            <script>

            </script>
            <div class="col-xs-12 col-md-3 no-margin sidebar " id="listTotalPrice">

                <div class="widget cart-summary">
                    <h1 class="border">shopping cart</h1>
                    <div class="body">
                        <ul class="tabled-data no-border inverse-bold">
                            <li>
                                <label>cart subtotal</label>
                                <div class="value pull-right sum-prices"  th:text="${tongTienCart}"></div>
                            </li>
                            <li>
                                <label>shipping</label>
                                <div class="value pull-right">free shipping</div>
                            </li>
                        </ul>
                        <ul id="total-price" class="tabled-data inverse-bold no-border">
                            <li>
                                <label>order total</label>
                                <div class="value pull-right sum-prices"  th:text="${tongTienCart}"></div>
                            </li>
                        </ul>
                        <div class="buttons-holder">
                            <a class="le-button big"
                               href="/cart/check-out">checkout</a>
                            <a class="simple-link block"
                               href="/">continue
                                shopping</a>
                        </div>
                    </div>
                </div><!-- /.widget -->


            </div><!-- /.sidebar -->

            <!-- ========================================= SIDEBAR : END ========================================= -->
        </div>
    </section>
    <!--    =============================================END BODY=========================================-->
    <div th:replace="user/fragments :: recentlyViewed"></div>
    <div th:replace="user/fragments :: footer"></div>
</div>
</body>
<script>
    document.title = "Đăng nhập";

    function changeNumberProduct(maSP, maDH, n) {
        $("#listProductInCart").empty();
        $("#listTotalPrice").empty();
        var s = "";
        if(n == 1){
            s="add";
        }else if(n == -1){
            s="reduce";
        }
        $.ajax({
            url:"/api/cart/"+s+"/"+maSP+"/"+maDH,
            method:"get",
            success:function (data) {
                var totalPrice=0;
                data.forEach(item =>{
                    var gia = item.tonggia.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    totalPrice += item.tonggia;
                    $("#listProductInCart").append("<div class=\"row no-margin cart-item\">\n" +
                        "                        <div class=\"col-xs-12 col-sm-2 no-margin\">\n" +
                        "                            <a href=\"#\" class=\"thumb-holder\">\n" +
                        "                                <img class=\"lazy\" alt=\""+item.sanpham.tenSp+"\" src=\"/image/"+item.sanpham.maSp+"/"+item.sanpham.anh+"\">\n" +
                        "                            </a>\n" +
                        "                        </div>\n" +
                        "\n" +
                        "                        <div class=\"col-xs-12 col-sm-5 \">\n" +
                        "                            <div class=\"title\">\n" +
                        "                                <a href=\"#\">"+item.sanpham.tenSp+"</a>\n" +
                        "                            </div>\n" +
                        "                            <div class=\"brand\">sony</div>\n" +
                        "                        </div>\n" +
                        "                        <div class=\"col-xs-12 col-sm-2 no-margin\">\n" +
                        "                            <div class=\"quantity\">\n" +
                        "                                <div class=\"le-quantity\">\n" +
                        "                                    <a class=\"minus\" id=\"reduceProduct\" onclick=\"changeNumberProduct("+item.sanpham.maSp+","+maDH+",-1);\" href=\"#reduce\"></a>\n" +
                        "                                    <input name=\"quantity\" readonly=\"readonly\" type=\"text\" value=\""+item.soluong+"\">\n" +
                        "                                    <a class=\"plus\" id=\"addProduct\" onclick=\"changeNumberProduct("+item.sanpham.maSp+","+maDH+",1);\" href=\"#add\"></a>\n" +
                        "                                </div>\n" +
                        "                            </div>\n" +
                        "                        </div>\n" +
                        "\n" +
                        "                        <div class=\"col-xs-12 col-sm-3 no-margin\">\n" +
                        "                            <div class=\"price\">"+gia+" VNĐ</div>\n" +
                        "                            <a class=\"close-btn\" onclick=\"return confirm('Bạn có chắc muốn xoá sản phẩm này ??')\" href=\"/cart/delete?maSP=1002\"></a>\n" +
                        "                        </div>\n" +
                        "                    </div>");
                });
                var totalPriceS = totalPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                $("#listTotalPrice").append("                <div class=\"widget cart-summary\">\n" +
                    "                    <h1 class=\"border\">shopping cart</h1>\n" +
                    "                    <div class=\"body\">\n" +
                    "                        <ul class=\"tabled-data no-border inverse-bold\">\n" +
                    "                            <li>\n" +
                    "                                <label>cart subtotal</label>\n" +
                    "                                <div class=\"value pull-right\">"+totalPriceS+" VNĐ</div>\n" +
                    "                            </li>\n" +
                    "                            <li>\n" +
                    "                                <label>shipping</label>\n" +
                    "                                <div class=\"value pull-right\">free shipping</div>\n" +
                    "                            </li>\n" +
                    "                        </ul>\n" +
                    "                        <ul id=\"total-price\" class=\"tabled-data inverse-bold no-border\">\n" +
                    "                            <li>\n" +
                    "                                <label>order total</label>\n" +
                    "                                <div class=\"value pull-right\">"+totalPriceS+" VNĐ</div>\n" +
                    "                            </li>\n" +
                    "                        </ul>\n" +
                    "                        <div class=\"buttons-holder\">\n" +
                    "                            <a class=\"le-button big\"\n" +
                    "                               href=\"/cart/check-out\">checkout</a>\n" +
                    "                            <a class=\"simple-link block\"\n" +
                    "                               href=\"\">continue\n" +
                    "                                shopping</a>\n" +
                    "                        </div>\n" +
                    "                    </div>\n" +
                    "                </div><!-- /.widget -->");

            }
        })
    }
</script>
</html>